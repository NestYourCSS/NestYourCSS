<!--
  To-do now:
  - Style .ace_search
  - Area to drop in files
  - Ability to send a link of a CSS file
  - Button to clear the code (could just CTRL+A & Backspace)
  - Show list of errors, and a button to jump to them
  - Button to add samples of CSS
  - Show the file size of both CSS outputs
  - Send the Nested output to a raw file
  - Change indentation setting
  - Mention "it's recommended to use diff, and add in the old CSS selectors to the new" (because this tool also reformats your code and removes comments)

  List of (potential) parts to add to the site:
  - History of all conversions to Nested CSS >> Auto-save every minute? Or just "Nest" button (probably both, but auto-save is toggleable)
  - Button to use the previous selector instead (a.k.a. previous diff, but only for selectors)
  - Paredit may be useful
  - Keyboard Shortcuts extension has a lot of useful stuff, will have to "re-develop" to: limit what features are possible and re-design.
  - Add a minimap, might have to DIY
  - Sticky Scroll - Official Ace Extensions (DIY)
  - Add like a Table of Contents page, like Figma's Layers component
  - Add an anti-adblock background, along with the border

  Later:
  - Full revamp
  - Implement locomotive scroll or some other momentum scroll plugin (https://github.com/locomotivemtl/locomotive-scroll)
  - Information on how to (manually) Nest your CSS
  - Replace some of the changed, nested CSS with the original CSS (through AceDiff)
  - Change modes from light to dark modes
  - Section input both HTML and CSS code and to display Nested CSS output
  - Allow comments >> Might require a code revamp
  - Ability to nest multiple CSS files at the same time
  - Option to allow emmet?

  Code to go to specific line:
    // Assuming 'editor' is your Ace Editor instance
    var lineNumber = 10; // Replace with your desired line number

    // Get the content of the line
    var lineContent = editor.session.getLine(lineNumber - 1); // Ace Editor uses 0-based index

    // Scroll to the line
    editor.scrollToLine(lineNumber, true, true, function () {});

    // Optionally, highlight the line
    editor.gotoLine(lineNumber, 0, true);

    console.log("Line Content: ", lineContent);
-->
  
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="./assets/logo.png" />
  <title>Nest Your CSS</title>
  
  <script src="./lib/ace.min.js"></script>
  
  <link href="./styles/main.css" rel="stylesheet">
  <link href="./styles/editor.css" rel="stylesheet">
  <link href="./styles/fonts.css" rel="stylesheet">
</head>
<body>
  <div id="code-editor-wrapper">
    <button>Nest!</button>
    <div id="code-editor">
      <div class="editor" id="leftEditor"></div>
      <div class="editor" id="rightEditor"></div>
    </div>
  </div>

  <script src="./main.js" type="text/javascript"></script>

  <script src="./lib/mode-css.js"></script>
  <script src="./lib/ace-linters.min.js"></script>
  <script src="./lib/ext-searchbox.min.js"></script>
  <!-- <script src="./scripts/ext-stickyscroll.js"></script> -->
  <!-- <script src="./lib/ext-language_tools.min.js"></script> -->


  <script>
    let provider = LanguageProvider.fromCdn("https://www.unpkg.com/ace-linters@1.2.3/build/");
    
    function initializeEditor(editorId, value) {
      const editor = ace.edit(editorId, {
        mode: "ace/mode/css",
        showPrintMargin: false
      });

      editor.setValue(value, -1);
      provider.registerEditor(editor);

      /*
      let textarea = editor.container.getElementsByTagName('textarea')[0];
      textarea.name = editor.container.id + 'Textarea';

      // Remove any support tools that may cause lag and don't provide utility
      textarea.setAttribute('autocomplete', 'off');
      textarea.setAttribute('autocorrect', 'off');
      textarea.setAttribute('autocapitalize', 'off');
      textarea.setAttribute('spellcheck', 'false');

      // Add the aria- equivalents
      textarea.setAttribute('aria-autocomplete', 'none');
      textarea.setAttribute('aria-correct', 'false');
      textarea.setAttribute('aria-capitalize', 'none');
      textarea.setAttribute('aria-spellcheck', 'false');
      */

      return editor;
    }

    let sample;
    // sample = cssSamples[0];
    // sample = cssSamples[1];
    // sample = cssSamples.slice(0, 2).join('');
    sample = cssSamples.join('');

    const leftEditor = initializeEditor("leftEditor", sample || '/* Your input CSS should go here */');
    const rightEditor = initializeEditor("rightEditor", '/* Your output CSS will appear here */');

    let editors = [leftEditor, rightEditor];

    // Auto Nest
    let codeChanged = false;
    let isProcessing = false;

    leftEditor.getSession().on('change', () => {
      codeChanged = true;
    });
    
    leftEditor.getSession().on('changeAnnotation', () => {
      if (!isProcessing) {
        isProcessing = true;

        setTimeout(() => {
          if (codeChanged) {
            nestCode();
            codeChanged = false;
          }

          isProcessing = false;
        }, 0);
      }
    });

    // Initial Nest
    leftEditor.getSession()._emit('change', {
      start: { row: 0, column: 0 },
      end: { row: 0, column: 0 },
      action: 'insert',
      lines: []
    });
</script>
</body>
</html>